@model IEnumerable<QuanLiBanSach02.spThongKeDoanhThuTheoNamResult>

@{
    ViewBag.Title = "Thống kê";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

<div class="grid__auto">
    <div>
        <h1 class="text-center">Thống kê doanh thu theo thể loại</h1>
        <label for="ddlYear">Nhập năm:</label>
        <input id="ddlYear" name="year" placeholder="Nhập năm" />
        <input id="btn-search1" type="button" value="Tìm" />

        <div id="container" style="display: flex;justify-content: center;width: 100%; height:600px;margin-top: 25px;margin-bottom: 10px;">
            <canvas id="canvas"></canvas>
        </div>


        <h1 class="text-center">Thống kê số lượng sách đã bán</h1>
        <label for="ddlMonth">Nhập tháng:</label>
        <input id="ddlMonth" name="month" placeholder="Nhập tháng" />
        <input id="btn-search2" type="button" value="Tìm" />
        <div>
            <div id="statsContainer"></div>

            <div id="container" style="display: flex;justify-content: center;width: 100%; height:600px;margin-top: 25px;margin-bottom: 10px;">
                <canvas id="canvasNumberProduct"></canvas>
            </div>
        </div>

    </div>
</div>

@section scripts{

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>

        //$.ajax({
        //    url: "/Controller/StatsNumberProductByMonth",
        //    data: {month: 8},
        //    success: function (result) {
        //        var html = "";

        //        $.each(result, function (i, item) {
        //            html += "<p>" + item.ProductName + ": " + item.soLuong + "</p>";
        //        });

        //        $("#divStats").html(html);
        //    }
        //});


        window.onload = () => {
            var myChart;
            $('#btn-search1').click(function () {
                let year = $('#ddlYear').val();
                if (window.myChart) {
                    window.myChart.destroy();
                }
                $.get('/Admin/Stats/StatsByYear?year=' + year, function (res) {
                    ChartProductCategoryByYear(res);

                    //console.log(year)
                });
            });

            function ChartProductCategoryByYear(lsDataCategoryByYear) {
                let lsLabel = [];
                let lsDataSource = [];

                $.each(lsDataCategoryByYear, function (index, item) {
                    lsLabel.push(item.CategoryName);
                    lsDataSource.push(item.TongTien);
                });

                let ctx = document.getElementById('canvas').getContext('2d');

                let colors = [];

                for (let i = 0; i < lsLabel.length; i++) {
                    let r = Math.random() * 255;
                    let g = Math.random() * 255;
                    let b = Math.random() * 255;
                    colors.push(`rgb(${r},${g},${b},0.2)`);
                }

                myChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: lsLabel,
                        datasets: [{
                            data: lsDataSource,
                            backgroundColor: colors,
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        title: {
                            display: true,
                            text: "Thống kê doanh thu theo thể loại"
                        }
                    }
                });
            }


            var myChart1;
            $('#btn-search2').click(function () {
                let month = $('#ddlMonth').val();
                //if (window.myChart1) {
                //    window.myChart1.destroy();
                //}
                $.get('/Admin/Stats/StatsNumberProductByMonth?month=' + month, function (res) {
                    ChartNumberProduct(res);
                    DisplayStats(res);

                    //console.log(res)
                });
            });

            function DisplayStats(lsDataNumberProduct) {
                let statsHTML = '';

                // Generate the HTML content for the statistics
                for (let i = 0; i < lsDataNumberProduct.length; i++) {
                    let productName = lsDataNumberProduct[i].ProductName;
                    let quantity = lsDataNumberProduct[i].soLuong;

                    // Format the statistics as desired
                    let statText = `Product: ${productName}, Quantity: ${quantity}`;

                    // Append the formatted statistics to the statsHTML
                    statsHTML += `<p>${statText}</p>`;
                }

                // Update the content of the statsContainer element
                $('#statsContainer').html(statsHTML);
            }

            function ChartNumberProduct(lsDataNumberProduct) {
                let lsLabel1 = [];
                let lsDataSource1 = [];
                //let ctx1 = document.getElementById('').getContext('2d');

                $.each(lsDataNumberProduct, function (index, item) {
                    lsLabel1.push(item.ProductName);
                    lsDataSource1.push(item.soLuong)
                })
                //console.log(lsDataSource1)
                //console.log(lsLabel1)
                let colors1 = []

                for (let i = 0; i < lsLabel1.length; i++) {
                    let r = Math.random() * 255;
                    let g = Math.random() * 255;
                    let b = Math.random() * 255;
                    colors1.push(`rgb(${r},${g},${b},0.2)`);
                }

                let ctx1 = document.getElementById('canvasNumberProduct')
                myChart1 = new Chart(ctx1, {
                    type: "pie",
                    data: {
                        labels: lsLabel1,
                        datasets: [{
                            backgroundColor: colors1,
                            data: lsDataSource1
                        }]
                    },
                    options: {
                        title: {
                            display: true,
                            text: "Thống kê doanh thu theo sản phẩm"
                        }
                    }
                });
            }

            //let barChartData = {
            //    labels: lsLabel,
            //    datasets: [{
            //        label: 'Tổng tiền',
            //        backgroundColor: colors,
            //        borderWidth: 1,
            //        data: lsDataSource
            //    }, ]

            //};

            //let myBar = new Chart(ctx, {
            //    type: 'bar',
            //    data: barChartData,
            //    options: {
            //        scales: {
            //            y: {
            //                beginAtZero: true
            //            }
            //        }
            //    }
            //});
        }
    </script>
}